window.userPoint=null;window.userCity=null;window.isBootmarkerClusterer=null;window.noBootmarkerClusterer=null;window.resultListMarker=null;window.imgSrc="/Health_Scale_Portal/static/robot/img/";function MapObject(){this.addMarker=function(a){a=new BMap.Marker(a,{icon:mapsetObj.icon.thisicon});map.addOverlay(a);a.addEventListener("click",function(a){})};this.icon={};this.icon.thisicon=new BMap.Icon(imgSrc+"thisicon.png",new BMap.Size(15,15),{offset:new BMap.Size(0,0),imageOffset:new BMap.Size(0,0),anchor:new BMap.Size(15,15)});this.icon.l_icon=new BMap.Icon(imgSrc+"l_icon.png",new BMap.Size(25,25),{offset:new BMap.Size(0,0),imageOffset:new BMap.Size(0,0),anchor:new BMap.Size(25,25)});this.icon.a_icon=new BMap.Icon(imgSrc+"a_icon.png",new BMap.Size(25,25),{offset:new BMap.Size(0,0),imageOffset:new BMap.Size(0,0),anchor:new BMap.Size(25,25)});this.icon.this_l_icon=new BMap.Icon(imgSrc+"l_icon_b.png",new BMap.Size(25,25),{offset:new BMap.Size(0,0),imageOffset:new BMap.Size(0,0),anchor:new BMap.Size(25,25)});this.icon.this_a_icon=new BMap.Icon(imgSrc+"a_icon_b.png",new BMap.Size(25,25),{offset:new BMap.Size(0,0),imageOffset:new BMap.Size(0,0),anchor:new BMap.Size(25,25)});this.Bootmustyle={};this.Bootmustyle.isBoot=[{url:imgSrc+"l_icon.png",size:new BMap.Size(0,0),opt_anchor:[16,0],textColor:"rgba(0,0,0,0)",opt_textSize:10}];this.Bootmustyle.noBoot=[{url:imgSrc+"a_icon.png",size:new BMap.Size(0,0),opt_anchor:[16,0],textColor:"rgba(0,0,0,0)",opt_textSize:10}];this.BootaddMarker=function(a,c){map.addOverlay(a);a.addEventListener("click",function(a){a=new BMap.Point(this.point.lng,this.point.lat);map.removeOverlay(resultListMarker);$("#showrobot").show();$("#hos").html(this._YLshop);$("#addr").html(this._YLaddress);$("#iphone").html(this._YLmobile);c?(resultListMarker=new BMap.Marker(a,{icon:mapsetObj.icon.this_l_icon}),$(".robot_status").hide()):(resultListMarker=new BMap.Marker(a,{icon:mapsetObj.icon.this_a_icon}),$(".robot_status").show());resultListMarker.setZIndex(1);map.addOverlay(resultListMarker)})}}var mapsetObj=new MapObject,map=new BMap.Map("map_content",{minZoom:5,maxZoom:18});function positionFun(){(new BMap.Geolocation).getCurrentPosition(function(a){this.getStatus()==BMAP_STATUS_SUCCESS&&(userPoint=a.point,map.centerAndZoom(userPoint,13),mapsetObj.addMarker(userPoint),(new BMap.Geocoder).getLocation(userPoint,function(a){userCity=a.addressComponents.city;resetdata(addMarkerCallback);map.addEventListener("moveend",function(){});map.addEventListener("zoomend",function(){clearMarker();resetdata(addMarkerCallback)});map.addEventListener("dragend",function(){clearMarker();resetdata(addMarkerCallback)})}))})}function resetdata(a){var c=map.getZoom(),b=map.getBounds().Ie,f=map.getBounds().Je,g=map.getBounds().De,h=map.getBounds().Ee,e=map.getCenter(),d={};d.city=userCity;d.Zoom=c;d.latStart=b;d.latEnd=g;d.lngStart=f;d.lngEnd=h;d.centerLat=e.lat;d.centerLng=e.lng;$.ajax({url:"gps",type:"post",data:d,dataType:"json",beforeSend:function(){$("#tishi").html("\u4e3a\u60a8\u67e5\u627e<br>\u673a\u5668\u4e2d\uff0c\u8bf7\u7a0d\u5019!");$("#tishi").show()},complete:function(){setTimeout(function(){$("#tishi").hide()},300)}}).then(a)}function addMarkerCallback(a){for(var c=null,b=0;b<a.length;b++)1==a[b].isBoot?(c=new BMap.Marker(new BMap.Point(a[b].lng,a[b].lat),{icon:mapsetObj.icon.l_icon}),c._YLshop=a[b].shop,c._YLaddress=a[b].address,c._YLmobile=a[b].mobile,c._YLcode=a[b].code,mapsetObj.BootaddMarker(c,!0)):(c=new BMap.Marker(new BMap.Point(a[b].lng,a[b].lat),{icon:mapsetObj.icon.a_icon}),c._YLshop=a[b].shop,c._YLaddress=a[b].address,c._YLmobile=a[b].mobile,c._YLcode=a[b].code,mapsetObj.BootaddMarker(c,!1))}function clearMarker(){map.clearOverlays();mapsetObj.addMarker(userPoint)}navigator.geolocation?positionFun():alert("Geolocation is not supported by this browser.");